# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è —Ç–∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–ú–æ–¥—É–ª—å —Ç–∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π (`tkan_specifications`) –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã `fabric_types`. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∫–∞–Ω—è—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ä–∞—Å—Ö–æ–¥–∞ –Ω–∏—Ç–∏ –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º
- ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `production_weaving`:**
- `fabric_spec_id` - ID —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ `tkan_specifications`
- `fabric_code` - –∫–æ–¥ —Ç–∫–∞–Ω–∏ (–¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
- `fabric_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∫–∞–Ω–∏ (–¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
- `weft_denier` - –¥–µ–Ω—å–µ —É—Ç–∫–∞
- `warp_denier` - –¥–µ–Ω—å–µ –æ—Å–Ω–æ–≤—ã

**–ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `fabric_inventory`:**
- `fabric_spec_id` - ID —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `fabric_code` - –∫–æ–¥ —Ç–∫–∞–Ω–∏
- `fabric_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∫–∞–Ω–∏

### 2. –†–∞—Å—á–µ—Ç —Ä–∞—Å—Ö–æ–¥–∞ –Ω–∏—Ç–∏

–¢–µ–ø–µ—Ä—å —Ä–∞—Å—Ö–æ–¥ –Ω–∏—Ç–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ –ø–æ–ª–µ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:
- **–£—Ç–æ–∫**: `–¥–ª–∏–Ω–∞_–º–µ—Ç—Ä–æ–≤ √ó utok_itogo_kg`
- **–û—Å–Ω–æ–≤–∞**: `–¥–ª–∏–Ω–∞_–º–µ—Ç—Ä–æ–≤ √ó osnova_itogo_kg`

–ì–¥–µ:
- `utok_itogo_kg` - –≤–µ—Å —É—Ç–∫–∞ –≤ 1 –º–µ—Ç—Ä–µ —Ç–∫–∞–Ω–∏ (–∫–≥)
- `osnova_itogo_kg` - –≤–µ—Å –æ—Å–Ω–æ–≤—ã –≤ 1 –º–µ—Ç—Ä–µ —Ç–∫–∞–Ω–∏ (–∫–≥)

### 3. –í—ã–±–æ—Ä –ø–∞—Ä—Ç–∏–π –Ω–∏—Ç–∏

–ü–∞—Ä—Ç–∏–∏ –Ω–∏—Ç–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –¥–µ–Ω—å–µ –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:
- –î–ª—è —É—Ç–∫–∞: —Ñ–∏–ª—å—Ç—Ä –ø–æ `utok_denye`
- –î–ª—è –æ—Å–Ω–æ–≤—ã: —Ñ–∏–ª—å—Ç—Ä –ø–æ `osnova_denye`

## –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

–í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
-- –§–∞–π–ª: supabase/weaving-migrate-to-specs.sql
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—ã.

### –®–∞–≥ 2: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
SELECT COUNT(*) FROM tkan_specifications;
```

–ï—Å–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π –Ω–µ—Ç - —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π.

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥

–ö–æ–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –≤:
- `app/production/weaving/page.tsx`

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–∫–∞—á–µ—Å—Ç–≤–∞: `/production/weaving`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ —Å–ø–∏—Å–∫–µ —Ç–∫–∞–Ω–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å–º–µ–Ω—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–∞—Å—Ö–æ–¥ –Ω–∏—Ç–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –ß—Ç–æ –¥–∞–ª—å—à–µ

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π

–ö–æ–≥–¥–∞ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è:
```sql
ALTER TABLE production_weaving
  DROP COLUMN IF EXISTS fabric_type_id,
  DROP COLUMN IF EXISTS weft_yarn_code,
  DROP COLUMN IF EXISTS warp_yarn_code;

ALTER TABLE fabric_inventory
  DROP COLUMN IF EXISTS fabric_type_id;
```

### TODO: –°–ø–∏—Å–∞–Ω–∏–µ –Ω–∏—Ç–∏

–°–µ–π—á–∞—Å —Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∏—Ç–∏ **–ù–ï** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ç–∞–∫ –∫–∞–∫ –Ω—É–∂–Ω–∞ —Å–≤—è–∑—å –º–µ–∂–¥—É:
- –î–µ–Ω—å–µ –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚Üí –ö–æ–¥ –Ω–∏—Ç–∏ –≤ `yarn_types`

–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:
1. –î–æ–±–∞–≤–∏—Ç—å –≤ `tkan_specifications` –ø–æ–ª—è `weft_yarn_code` –∏ `warp_yarn_code`
2. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–≤—è–∑–∏ `denier_to_yarn_code_mapping`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 800D ‚Üí PP-800D)

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –î–æ (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
```typescript
// –í—ã–±–æ—Ä —Ç–∫–∞–Ω–∏ –∏–∑ fabric_types
const fabric = fabricTypes.find(f => f.id === formData.fabric_type_id);
const weftConsumption = length * fabric.weft_consumption_per_meter;
```

### –ü–æ—Å–ª–µ (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
```typescript
// –í—ã–±–æ—Ä —Ç–∫–∞–Ω–∏ –∏–∑ tkan_specifications
const spec = fabricSpecs.find(f => f.id === formData.fabric_spec_id);
const weftConsumption = length * spec.utok_itogo_kg;
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–¢–æ—á–Ω–æ—Å—Ç—å** - —Ä–∞—Å—Ö–æ–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º
2. **–ì–∏–±–∫–æ—Å—Ç—å** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
3. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –æ–¥–∏–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –≤–∏–¥—ã —Ç–∫–∞–Ω–µ–π

## –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä—É–ª–æ–Ω–æ–≤ –º–µ–∂–¥—É —Å–º–µ–Ω–∞–º–∏

–ú–æ–¥—É–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ä—É–ª–æ–Ω–æ–≤** –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏:

üìö **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [WEAVING_ROLL_CONTINUATION.md](WEAVING_ROLL_CONTINUATION.md)

### –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

1. **–û–ø–µ—Ä–∞—Ç–æ—Ä –ê** –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä—É–ª–æ–Ω ‚Üí —Å—Ç–∞—Ç—É—Å "–í —Ä–∞–±–æ—Ç–µ"
2. **–û–ø–µ—Ä–∞—Ç–æ—Ä –ë** –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä—É–ª–æ–Ω ‚Üí —Å—Ç–∞—Ç—É—Å "–í —Ä–∞–±–æ—Ç–µ"
3. **–û–ø–µ—Ä–∞—Ç–æ—Ä –í** –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä—É–ª–æ–Ω ‚Üí —Å—Ç–∞—Ç—É—Å "–ó–∞–≤–µ—Ä—à–µ–Ω" ‚Üí –æ–ø—Ä–∏—Ö–æ–¥–æ–≤–∞–Ω–∏–µ

**–£—á–µ—Ç –¥–ª—è KPI:**
- `length_meters` - –¥–ª–∏–Ω–∞ –∑–∞ —Ç–µ–∫—É—â—É—é —Å–º–µ–Ω—É (–≤–∫–ª–∞–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞)
- `total_length_meters` - –æ–±—â–∞—è –¥–ª–∏–Ω–∞ —Ä—É–ª–æ–Ω–∞ (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ)
- `previous_doc_id` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–º–µ–Ω—É

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `tkan_specifications` —Å–æ–∑–¥–∞–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase
