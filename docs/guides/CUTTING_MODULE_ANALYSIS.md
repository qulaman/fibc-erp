# Анализ модуля кроя из Google Sheets

## Обзор модуля

Модуль кроя предназначен для раскроя ткани, ламината и строп на детали для производства мешков FIBC.

## Основные сущности

### 1. Типы материалов для кроя
- **Ткань** - рулоны из цеха ткачества
- **Ламинат** - рулоны из цеха ламинации
- **Стропы** - стропы из цеха строп

### 2. Типы кроя (Справочник_Типы_Кроя)
Содержит информацию о деталях:
- Код детали
- Категория (например: "Донышко", "Боковина", "Петля")
- Наименование
- Тип материала (Ткань, Ткань/Ламинат, Стропа)
- Ширина (см)
- Длина (см)
- Расход на 1 шт (см) - сколько материала нужно на 1 деталь
- Вес (граммы)
- Описание
- Статус (Активно/Неактивно)

### 3. Журнал производства (Журнал_Производство_Крой)
Хранит историю операций кроя:
- Номер документа (ПРВ-YYYYMMDD-NNNN)
- Дата, Время
- Смена (День/Ночь)
- Оператор
- Номер рулона/стропы
- Тип материала
- Код материала
- Израсходовано (м)
- Категория детали
- Код детали
- Наименование детали
- Количество (шт)
- Расход материала (м)
- Отходы (м)
- Вес готовых деталей (кг)
- Статус

### 4. Склад кроеных деталей (Склад_Кроеные_Детали)
Учет готовых деталей:
- Номер документа
- Дата, Время
- Операция (Приход/Расход)
- Код детали
- Наименование
- Категория
- Количество (шт)
- Источник (номер рулона)
- Оператор
- Статус

### 5. Балансовый лист (Остатки_Кроеные_Детали)
Вычисляемые остатки деталей через формулы

## Бизнес-процесс

1. **Выбор типа материала**: Оператор выбирает - будет кроить ткань/ламинат или стропы
2. **Выбор материала**: Из доступных рулонов/строп на складе
3. **Выбор типа кроя**: Какую деталь нужно раскроить (донышко, боковина и т.д.)
4. **Указание количества**: Сколько деталей нужно
5. **Расчет расхода**: Система автоматически рассчитывает сколько материала потребуется
6. **Указание отходов**: Обрезки, брак
7. **Проведение операции**:
   - Запись в журнал производства
   - Списание материала со склада (ткачество/ламинация/стропы)
   - Оприходование деталей на склад кроеных деталей
   - Запись трассировки (откуда пришел материал)

## Формат номеров

- **Партии**: `CUT-YYMMDD-NNN` (например: CUT-250122-001)
- **Документы производства**: `ПРВ-YYYYMMDD-NNNN` (например: ПРВ-20250122-0001)
- **Документы расхода**: `РСХ-YYYYMMDD-NNNN`

## Трассировка

Система записывает полный путь материала:
- Откуда взят материал (номер рулона/стропы)
- Что произведено (код детали)
- Кто оператор
- Сколько израсходовано
- Сколько отходов

## Структура БД для Supabase

### Таблица: cutting_types (Типы кроя)
```sql
- id: uuid (PK)
- code: text (уникальный код детали)
- category: text (категория: донышко, боковина, петля и т.д.)
- name: text (наименование)
- material_type: text (Ткань, Ткань/Ламинат, Ламинат, Стропа)
- width_cm: numeric (ширина в см)
- length_cm: numeric (длина в см)
- consumption_cm: numeric (расход на 1 шт в см)
- weight_g: numeric (вес 1 детали в граммах)
- description: text
- status: text (Активно/Неактивно)
- created_at: timestamp
- updated_at: timestamp
```

### Таблица: production_cutting (Журнал производства кроя)
```sql
- id: uuid (PK)
- doc_number: text (уникальный номер документа)
- date: date
- time: time
- shift: text (День/Ночь)
- operator: text
- roll_number: text (номер рулона или код стропы)
- material_type: text (Ткань/Ламинат/Стропа)
- material_code: text
- total_used_m: numeric (израсходовано всего метров)
- cutting_type_category: text
- cutting_type_code: text
- cutting_type_name: text
- quantity: integer (количество деталей)
- consumption_m: numeric (расход материала в метрах)
- waste_m: numeric (отходы в метрах)
- total_weight_kg: numeric (общий вес деталей)
- status: text (Проведено/Черновик/Отменено)
- created_at: timestamp
- updated_at: timestamp
```

### Таблица: cutting_parts_warehouse (Склад кроеных деталей)
```sql
- id: uuid (PK)
- doc_number: text
- date: date
- time: time
- operation: text (Приход/Расход)
- cutting_type_code: text
- cutting_type_name: text
- category: text
- quantity: integer
- source_number: text (номер рулона-источника)
- operator: text
- status: text
- created_at: timestamp
- updated_at: timestamp
```

### View: cutting_parts_balance (Остатки деталей)
Вычисляемое представление с группировкой по коду детали
