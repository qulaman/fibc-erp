# Руководство по миграции МФН на отдельный склад

## Обзор
МФН нить выделяется в отдельный склад `mfn_warehouse` для независимого учета и управления.

## Модули, требующие обновления

### 1. **Производство строп** (`app/production/straps/page.tsx`)
- **Текущее состояние**: Использует `raw_materials` для МФН
- **Изменения**:
  - Заменить `from('raw_materials')` на `from('mfn_warehouse')`
  - Обновить поля: вместо `raw_materials` использовать структуру `mfn_warehouse`
  - Списание МФН: записывать в `mfn_warehouse` с `operation_type = 'Расход'`

### 2. **Склад сырья** (`app/inventory/page.tsx`)
- **Текущее состояние**: Содержит все сырье, включая МФН
- **Изменения**:
  - Исключить МФН из отображения
  - Добавить фильтр, чтобы не показывать МФН

### 3. **История склада сырья** (`app/inventory/history/page.tsx`)
- **Текущее состояние**: Показывает все операции, включая МФН
- **Изменения**:
  - Отфильтровать МФН из истории

### 4. **Навигация** (`components/Navigation.tsx`)
- **Изменения**:
  - Добавить отдельный пункт "Склад МФН" в раздел "Склад"

## SQL Миграция

**Файл**: `supabase/create-mfn-warehouse.sql`

### Основные таблицы и представления:
1. `mfn_warehouse` - основная таблица склада МФН
2. `view_mfn_balance` - остатки МФН
3. `view_mfn_statistics` - статистика по МФН

### Перенос данных из inventory:
```sql
-- Раскомментировать блок в SQL-файле для переноса МФН из inventory в mfn_warehouse
```

## Новые страницы

### 1. Склад МФН (`app/warehouse/mfn/page.tsx`)
- Отображение остатков МФН
- История операций
- Приход/расход МФН

## Порядок внедрения

1. ✅ Выполнить SQL-миграцию `create-mfn-warehouse.sql`
2. ⏳ Создать страницу склада МФН
3. ⏳ Обновить производство строп
4. ⏳ Обновить навигацию
5. ⏳ (Опционально) Перенести данные МФН из `inventory`
6. ⏳ Обновить склад сырья (исключить МФН)

## Структура mfn_warehouse vs inventory

| Поле | inventory | mfn_warehouse | Примечание |
|------|-----------|---------------|------------|
| Операция | `operation` | `operation_type` | Приход/Расход |
| Код | `code` | `material_code` | |
| Название | `name` | `material_name` | |
| Количество | `quantity_kg` | `quantity_kg` | |
| Денье | - | `denier` | Новое поле |
| Цвет | - | `color` | Новое поле |
| Поставщик | `supplier` | `supplier_name` | |

## Примечания
- МФН всегда `material_type = 'МФН'`
- Денье (denier) - важный параметр для МФН нити
- Отдельный склад позволяет вести независимый учет закупок и расходов
