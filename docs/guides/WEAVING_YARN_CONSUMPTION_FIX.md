# üßµ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∞–Ω–∏—è –Ω–∏—Ç–∏ –≤ —Ç–∫–∞—á–µ—Å—Ç–≤–µ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä—É–ª–æ–Ω–∞ —Ç–∫–∞–Ω–∏ —Å–∏—Å—Ç–µ–º–∞ **—Å—á–∏—Ç–∞–ª–∞** —Ä–∞—Å—Ö–æ–¥ –Ω–∏—Ç–∏ –ø–æ —É—Ç–∫—É –∏ –æ—Å–Ω–æ–≤–µ, –Ω–æ **–ù–ï —Å–ø–∏—Å—ã–≤–∞–ª–∞** –µ–≥–æ —Å–æ —Å–∫–ª–∞–¥–∞ –Ω–∏—Ç–∏ (`yarn_inventory`).

## –ü—Ä–∏—á–∏–Ω–∞

–ü–∞—Ä—Ç–∏–∏ –Ω–∏—Ç–∏ (`warp_batch_id`, `weft_batch_id`) –≤—ã–±–∏—Ä–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ **–∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏** —Ä—É–ª–æ–Ω–∞, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –ø—Ä–∏ –µ–≥–æ **—Å–æ–∑–¥–∞–Ω–∏–∏**. –ï—Å–ª–∏ —Ä—É–ª–æ–Ω —Ä–∞–±–æ—Ç–∞–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–º–µ–Ω, –ø–∞—Ä—Ç–∏–∏ —Ç–µ—Ä—è–ª–∏—Å—å.

## –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä—É–ª–æ–Ω–∞

**–§–∞–π–ª:** `app/production/weaving/page.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```typescript
// –ë–´–õ–û: –°–æ–∑–¥–∞–≤–∞–ª–∏ —Ä—É–ª–æ–Ω –±–µ–∑ –ø–∞—Ä—Ç–∏–π
const { data: newRoll, error: createError } = await supabase
  .from('weaving_rolls')
  .insert([{
    roll_number: rollNum,
    loom_id: formData.machine_id,
    fabric_spec_id: Number(formData.fabric_spec_id),
    status: 'active',
    total_length: 0,
    total_weight: 0
  }])

// –°–¢–ê–õ–û: –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä—Ç–∏–∏ —Å—Ä–∞–∑—É
const { data: newRoll, error: createError } = await supabase
  .from('weaving_rolls')
  .insert([{
    roll_number: rollNum,
    loom_id: formData.machine_id,
    fabric_spec_id: Number(formData.fabric_spec_id),
    warp_batch_id: formData.warp_batch_id,  // ‚Üê –°–û–•–†–ê–ù–Ø–ï–ú
    weft_batch_id: formData.weft_batch_id,  // ‚Üê –°–û–•–†–ê–ù–Ø–ï–ú
    status: 'active',
    total_length: 0,
    total_weight: 0
  }])
```

### 2. –í—ã–±–æ—Ä –ø–∞—Ä—Ç–∏–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä—É–ª–æ–Ω–∞

**–î–æ–±–∞–≤–ª–µ–Ω UI –±–ª–æ–∫:**
```typescript
{/* –í–´–ë–û–† –ü–ê–†–¢–ò–ô –ù–ò–¢–ò –î–õ–Ø –ù–û–í–û–ì–û –†–£–õ–û–ù–ê */}
{selectedSpec && (
  <div className="space-y-3 p-3 bg-emerald-900/10 border border-emerald-800/30 rounded-lg">
    <div className="text-xs text-emerald-400 font-bold uppercase">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—Ç–∏–∏ –Ω–∏—Ç–∏ *</div>

    {/* –ü–∞—Ä—Ç–∏—è –û—Å–Ω–æ–≤—ã */}
    <Select value={formData.warp_batch_id} onValueChange={v => setFormData({...formData, warp_batch_id: v})}>
      ...
    </Select>

    {/* –ü–∞—Ä—Ç–∏—è –£—Ç–∫–∞ */}
    <Select value={formData.weft_batch_id} onValueChange={v => setFormData({...formData, weft_batch_id: v})}>
      ...
    </Select>
  </div>
)}
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```typescript
// –ë–´–õ–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ formData (–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)
if (formData.warp_batch_id && totalWarp > 0) {
  await supabase
    .from('yarn_inventory')
    .update({ quantity_kg: newQty })
    .eq('id', formData.warp_batch_id);
}

// –°–¢–ê–õ–û: –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä—Ç–∏–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ä—É–ª–æ–Ω–∞
const { data: rollData } = await supabase
  .from('weaving_rolls')
  .select('warp_batch_id, weft_batch_id')
  .eq('id', rollId)
  .single();

if (rollData.warp_batch_id && totalWarp > 0) {
  await supabase
    .from('yarn_inventory')
    .update({ quantity_kg: newQty, quantity: newQty })
    .eq('id', rollData.warp_batch_id);
}
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω UI –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä—É–ª–æ–Ω–∞

**–ë–´–õ–û:** –í—ã–±–æ—Ä –ø–∞—Ä—Ç–∏–π –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ (–ø–æ–∑–¥–Ω–æ!)
**–°–¢–ê–õ–û:** –ü–æ–∫–∞–∑ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π –∏ —Ä–∞—Å—Ö–æ–¥–∞

```typescript
{formData.is_finished && currentSpec && activeRoll && (
  <div>
    <div className="text-xs text-red-300 font-bold uppercase">
      –ë—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω–æ –Ω–∏—Ç–∏ (–∑–∞ –≤–µ—Å—å —Ä—É–ª–æ–Ω: {totalRollLength} –º)
    </div>

    <div className="grid grid-cols-2 gap-3">
      <div>–û—Å–Ω–æ–≤–∞: {yarnStock.find(y => y.id === activeRoll.warp_batch_id)?.batch_number}</div>
      <div>–°–ø–∏—à–µ—Ç—Å—è: ~{warpConsumption} –∫–≥</div>

      <div>–£—Ç–æ–∫: {yarnStock.find(y => y.id === activeRoll.weft_batch_id)?.batch_number}</div>
      <div>–°–ø–∏—à–µ—Ç—Å—è: ~{weftConsumption} –∫–≥</div>
    </div>
  </div>
)}
```

## –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –°—Ü–µ–Ω–∞—Ä–∏–π: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä—É–ª–æ–Ω–∞

1. **–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä—É–ª–æ–Ω–∞:**
   - –û–ø–µ—Ä–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç–∞–Ω–æ–∫ ‚Üí —Å—Ç–∞–Ω–æ–∫ —Å–≤–æ–±–æ–¥–µ–Ω
   - –í—ã–±–∏—Ä–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é —Ç–∫–∞–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–¢–∫–∞–Ω—å 1000D")
   - **–ù–û–í–û–ï:** –í—ã–±–∏—Ä–∞–µ—Ç –ø–∞—Ä—Ç–∏—é –æ—Å–Ω–æ–≤—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "260122-1-EXT-01-1000W")
   - **–ù–û–í–û–ï:** –í—ã–±–∏—Ä–∞–µ—Ç –ø–∞—Ä—Ç–∏—é —É—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "260122-1-EXT-01-1000W")
   - –í–≤–æ–¥–∏—Ç –¥–ª–∏–Ω—É –∏ –≤–µ—Å —Å–º–µ–Ω—ã
   - –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–º–µ–Ω—ã"
   - ‚úÖ –†—É–ª–æ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è, **–ø–∞—Ä—Ç–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –≤ –ë–î

2. **–†–∞–±–æ—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–º–µ–Ω:**
   - –î–µ–Ω—å 1: +50 –º
   - –ù–æ—á—å: +40 –º
   - –î–µ–Ω—å 2: +60 –º
   - **–ü–∞—Ä—Ç–∏–∏ –ù–ï —Ç–µ—Ä—è—é—Ç—Å—è** - –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ä—É–ª–æ–Ω–µ

3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä—É–ª–æ–Ω–∞:**
   - –û–ø–µ—Ä–∞—Ç–æ—Ä –≤–≤–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–º–µ–Ω—É: +30 –º
   - –°—Ç–∞–≤–∏—Ç –≥–∞–ª–æ—á–∫—É "–°–Ω—è—Ç—å —Ä—É–ª–æ–Ω —Å–æ —Å—Ç–∞–Ω–∫–∞"
   - –í–∏–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: **–ö–∞–∫–∏–µ –ø–∞—Ä—Ç–∏–∏ –±—É–¥—É—Ç —Å–ø–∏—Å–∞–Ω—ã –∏ —Å–∫–æ–ª—å–∫–æ**
   - –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä—É–ª–æ–Ω –∏ —Å–ø–∏—Å–∞—Ç—å –Ω–∏—Ç—å"
   - ‚úÖ **–ù–∏—Ç—å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** —Å–æ —Å–∫–ª–∞–¥–∞:
     ```
     –ü–∞—Ä—Ç–∏—è 260122-1-EXT-01-1000W (–æ—Å–Ω–æ–≤–∞): -15.2 –∫–≥
     –ü–∞—Ä—Ç–∏—è 260122-1-EXT-01-1000W (—É—Ç–æ–∫): -12.8 –∫–≥
     ```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. ‚úÖ **–ù–∏—Ç—å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä—É–ª–æ–Ω–∞
2. ‚úÖ **–ü–∞—Ä—Ç–∏–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è** –º–µ–∂–¥—É —Å–º–µ–Ω–∞–º–∏
3. ‚úÖ **–¢–æ—á–Ω—ã–π —É—á–µ—Ç** —Ä–∞—Å—Ö–æ–¥–∞ –Ω–∏—Ç–∏
4. ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –≤–∏–¥–Ω–æ –∫–∞–∫–∏–µ –ø–∞—Ä—Ç–∏–∏ –±—É–¥—É—Ç —Å–ø–∏—Å–∞–Ω—ã
5. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —Ä—É–ª–æ–Ω –±–µ–∑ –≤—ã–±–æ—Ä–∞ –ø–∞—Ä—Ç–∏–π

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/production/weaving`
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∞–Ω–æ–∫
3. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é —Ç–∫–∞–Ω–∏
4. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—è–≤–∏–ª–∏—Å—å –ø–æ–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞—Ä—Ç–∏–π –Ω–∏—Ç–∏**
5. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—Ç–∏–∏ –æ—Å–Ω–æ–≤—ã –∏ —É—Ç–∫–∞
6. –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É/–≤–µ—Å
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ ‚Üí —Ä—É–ª–æ–Ω —Å–æ–∑–¥–∞–Ω
8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î: `SELECT * FROM weaving_rolls WHERE status='active'`
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã `warp_batch_id` –∏ `weft_batch_id`
9. –ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ä—É–ª–æ–Ω (–≥–∞–ª–æ—á–∫–∞ "–°–Ω—è—Ç—å —Ä—É–ª–æ–Ω")
10. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫–ª–∞–¥ –Ω–∏—Ç–∏: `SELECT * FROM yarn_inventory`
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å—Å—è

## –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—Ö–æ–¥–∞:

```
–†–∞—Å—Ö–æ–¥ –æ—Å–Ω–æ–≤—ã (–∫–≥) = –î–ª–∏–Ω–∞ —Ä—É–ª–æ–Ω–∞ (–º) √ó –†–∞—Å—Ö–æ–¥ –æ—Å–Ω–æ–≤—ã (–∫–≥/–º)
–†–∞—Å—Ö–æ–¥ —É—Ç–∫–∞ (–∫–≥) = –î–ª–∏–Ω–∞ —Ä—É–ª–æ–Ω–∞ (–º) √ó –†–∞—Å—Ö–æ–¥ —É—Ç–∫–∞ (–∫–≥/–º)
```

–ü—Ä–∏–º–µ—Ä:
- –†—É–ª–æ–Ω: 180 –º
- –¢–∫–∞–Ω—å: –æ—Å–Ω–æ–≤–∞ 1000D (—Ä–∞—Å—Ö–æ–¥ 0.085 –∫–≥/–º), —É—Ç–æ–∫ 1000D (—Ä–∞—Å—Ö–æ–¥ 0.071 –∫–≥/–º)
- **–°–ø–∏—à–µ—Ç—Å—è:**
  - –û—Å–Ω–æ–≤–∞: 180 √ó 0.085 = 15.3 –∫–≥
  - –£—Ç–æ–∫: 180 √ó 0.071 = 12.78 –∫–≥

–ì–æ—Ç–æ–≤–æ! üéâ
