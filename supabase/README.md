# üóÑÔ∏è SQL –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è Supabase

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –†–æ–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è (`/admin`) –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –æ—à–∏–±–∫–∞:
```
invalid input value for enum employee_role: "operator_lamination"
```

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é **[add-lamination-role.sql](add-lamination-role.sql)** —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ä–æ–ª–∏ –≤ ENUM.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [ADMIN_PAGE_SETUP.md](../ADMIN_PAGE_SETUP.md)

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 0Ô∏è‚É£ –í–∞–∂–Ω–æ: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏
–ú–æ–¥—É–ª—å —Ç–∫–∞—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π (`tkan_specifications`) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∫–∞–Ω—è—Ö, –Ω–æ—Ä–º–∞—Ö —Ä–∞—Å—Ö–æ–¥–∞ –Ω–∏—Ç–∏ –∏ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `tkan_specifications` —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥—É–ª—è.

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –º–æ–¥—É–ª—è —Ç–∫–∞—á–µ—Å—Ç–≤–∞
–§–∞–π–ª: [weaving-schema.sql](weaving-schema.sql)

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç:
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã: `fabric_types`, `production_weaving`, `fabric_inventory`
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏: `add_fabric_to_inventory`, `consume_yarn_for_weaving`
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã: –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at`
- ‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ: `fabric_stock_balance`

**–°–∫—Ä–∏–ø—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π** - –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±–µ–∑ –æ—à–∏–±–æ–∫.

---

### 2Ô∏è‚É£ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
–§–∞–π–ª: [weaving-migrate-to-specs.sql](weaving-migrate-to-specs.sql)

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π:
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç `fabric_spec_id`, `fabric_code`, `fabric_name` –≤ `production_weaving`
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç `weft_denier`, `warp_denier` –≤ `production_weaving`
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç `fabric_inventory` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –µ—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –º–æ–¥—É–ª—è —Ç–∫–∞—á–µ—Å—Ç–≤–∞.**

### 3Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–§–∞–π–ª: [weaving-sample-data.sql](weaving-sample-data.sql)

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç:
- ‚úÖ 3 —Ç–∫–∞—Ü–∫–∏—Ö —Å—Ç–∞–Ω–∫–∞
- ‚úÖ 3 –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Ç–∫–∞—á–µ—Å—Ç–≤–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∫–∞–Ω–µ–π –±–æ–ª—å—à–µ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π!

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ Supabase

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ SQL Editor (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
3. –°–æ–∑–¥–∞–π—Ç–µ **New query**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `weaving-schema.sql`
5. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ `Ctrl+Enter`)
6. –î–æ–∂–¥–∏—Ç–µ—Å—å —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚úÖ
7. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è `weaving-sample-data.sql`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Supabase CLI
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Å—Ö–µ–º—É
supabase db push weaving-schema.sql

# –î–æ–±–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ
supabase db push weaving-sample-data.sql
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
SELECT COUNT(*) FROM fabric_types;        -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 4
SELECT COUNT(*) FROM production_weaving;  -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0
SELECT COUNT(*) FROM fabric_inventory;    -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–Ω–∫–æ–≤
SELECT * FROM equipment WHERE type = 'weaving';  -- 3 —Å—Ç–∞–Ω–∫–∞

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
SELECT * FROM employees WHERE department = '–¢–∫–∞—á–µ—Å—Ç–≤–æ';  -- 3 –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
SELECT * FROM fabric_stock_balance;  -- –ü—É—Å—Ç—ã–µ –æ—Å—Ç–∞—Ç–∫–∏
```

---

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –û—à–∏–±–∫–∞: "column inventory_number does not exist"
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ
–°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω - –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–ª–æ–Ω–∫—É.

### ‚úÖ –û—à–∏–±–∫–∞: "relation idx_weaving_date already exists"
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ
–°–∫—Ä–∏–ø—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CREATE INDEX IF NOT EXISTS`.

### ‚úÖ –û—à–∏–±–∫–∞: "there is no unique or exclusion constraint matching the ON CONFLICT"
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ
–°–∫—Ä–∏–ø—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS` –≤–º–µ—Å—Ç–æ `ON CONFLICT`.

### ‚ö†Ô∏è –û—à–∏–±–∫–∞: "–¢–∏–ø –Ω–∏—Ç–∏ PP-800D –Ω–µ –Ω–∞–π–¥–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ:** –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ç–∏–ø—ã –Ω–∏—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `yarn_types`:
```sql
-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –Ω–∏—Ç–∏ –ü–ï–†–ï–î –∑–∞–ø—É—Å–∫–æ–º weaving-sample-data.sql
INSERT INTO yarn_types (code, name, denier, color, status) VALUES
('PP-800D', '–ü–æ–ª–∏–ø—Ä–æ–ø–∏–ª–µ–Ω 800D', '800D', '–ë–µ–ª—ã–π', '–ê–∫—Ç–∏–≤–Ω–æ'),
('PP-800D-GREEN', '–ü–æ–ª–∏–ø—Ä–æ–ø–∏–ª–µ–Ω 800D –∑–µ–ª–µ–Ω—ã–π', '800D', '–ó–µ–ª–µ–Ω—ã–π', '–ê–∫—Ç–∏–≤–Ω–æ'),
('PP-800D-BLUE', '–ü–æ–ª–∏–ø—Ä–æ–ø–∏–ª–µ–Ω 800D —Å–∏–Ω–∏–π', '800D', '–°–∏–Ω–∏–π', '–ê–∫—Ç–∏–≤–Ω–æ');
```

### ‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ `yarn_types` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É –º–æ–¥—É–ª—è —ç–∫—Å—Ç—Ä—É–∑–∏–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É:
```sql
CREATE TABLE IF NOT EXISTS yarn_types (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(255) NOT NULL,
  denier VARCHAR(50),
  color VARCHAR(100),
  status VARCHAR(20) DEFAULT '–ê–∫—Ç–∏–≤–Ω–æ'
);
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
fabric_types (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–∫–∞–Ω–µ–π)
‚îú‚îÄ‚îÄ id
‚îú‚îÄ‚îÄ code (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
‚îú‚îÄ‚îÄ name
‚îú‚îÄ‚îÄ width_cm, density, color
‚îú‚îÄ‚îÄ weft_yarn_code, warp_yarn_code
‚îú‚îÄ‚îÄ weft_consumption_per_meter, warp_consumption_per_meter
‚îî‚îÄ‚îÄ status

production_weaving (–ñ—É—Ä–Ω–∞–ª –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞)
‚îú‚îÄ‚îÄ id
‚îú‚îÄ‚îÄ doc_number (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
‚îú‚îÄ‚îÄ date, shift
‚îú‚îÄ‚îÄ machine_id ‚Üí equipment
‚îú‚îÄ‚îÄ operator_id ‚Üí employees
‚îú‚îÄ‚îÄ fabric_type_id ‚Üí fabric_types
‚îú‚îÄ‚îÄ weft_batch, warp_batch
‚îú‚îÄ‚îÄ length_meters, weight_kg
‚îú‚îÄ‚îÄ weft_consumption_kg, warp_consumption_kg
‚îú‚îÄ‚îÄ roll_status, roll_number
‚îú‚îÄ‚îÄ total_length_meters, total_weight_kg
‚îú‚îÄ‚îÄ previous_doc_id ‚Üí production_weaving (—Å–∞–º–æ—Å–≤—è–∑—å)
‚îî‚îÄ‚îÄ notes

fabric_inventory (–°–∫–ª–∞–¥ —Ç–∫–∞–Ω–∏)
‚îú‚îÄ‚îÄ id
‚îú‚îÄ‚îÄ doc_number (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
‚îú‚îÄ‚îÄ date, time
‚îú‚îÄ‚îÄ operation_type (–ü—Ä–∏—Ö–æ–¥/–†–∞—Å—Ö–æ–¥)
‚îú‚îÄ‚îÄ roll_number
‚îú‚îÄ‚îÄ fabric_type_id ‚Üí fabric_types
‚îú‚îÄ‚îÄ length_meters, weight_kg
‚îú‚îÄ‚îÄ linked_doc
‚îî‚îÄ‚îÄ counterparty
```

---

## üéØ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –º–æ–¥—É–ª—å —Ç–∫–∞—á–µ—Å—Ç–≤–∞ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- http://localhost:3001/production/weaving
